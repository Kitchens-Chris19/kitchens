<!DOCTYPE html>
<html>

<head>
   <link rel="stylesheet" type="text/css" href="hpStyle.css">
   <link href="https://fonts.googleapis.com/css?family=Galdeano" rel="stylesheet">
   <div class="navbar">
      <a href="index.html">Home</a>
      <a href="ajax.html">AJAX</a>
      <a href="dom.html">DOM</a>
      <a href="htmltags.html">HTML Tags</a>
      <a href="localStorage.html">Local Storage</a>
      <div class="dropdown">
         <button class="dropbtn">CSS3
            <i class="fa fa-caret-down"></i>
         </button>
         <div class="dropdown-content">
            <a href="css3animate.html">CSS3 Animations</a>
            <a href="css3transform.html">CSS3 Transforms</a>
            <a href="css3transition.html">CSS3 Transitions</a>
            <a href="cssjs.html">CSS3 with JS</a>
            <a href="css3all.html">CSS3 All Combined</a>
         </div>
      </div>
      <div class="dropdown">
         <button class="dropbtn">JavaScript
            <i class="fa fa-caret-down"></i>
         </button>
         <div class="dropdown-content">
            <a href="jsArrays.html">Arrays</a>
            <a href="jsobj.html">Objects</a>
            <a href="json.html">JSON</a>
            <a href="jsevents.html">JS Events</a>
         </div>
      </div>
   </div>
</head>

<body onload="loadXML();">
   <h1>
      Harry Potter Trivia!
   </h1>
   <div id="leftDiv">
      <button id="loadBtn" type="button" onclick="loadQuiz(counter);">Load Quiz</button>
   </div>

   <div id="playerInfo" style="float:left; position: absolute;">
      <h2>Player Info</h2>
      <p id="name">Name</p>
      <p id="house">House</p>
      <p id="points">0</p>
      <button type="button" id="getData" onclick=getData()>Input Data</button>
      <button type="button" id="saveStorage" onclick=savePlayer()>Save to local storage</button>
      <button type="button" id="loadStorage" onclick=loadPlayer()>Load data</button>
      <button type="button" id="clear" onclick = localStorage.clear()>Clear player info</button>
   </div>

   <div id="hpDiv" style="background-image: url('images/parchment.png');">
      <div id="questionDiv" style="transform:translate(300px, 100px);">
         <h3 id="question">Question</h3><br><br>

         <input type="radio" name="answer" id="a" value="a">
         <h4 id="ha" style="display: inline;">Answer A</h4> <br><br>
         <input type="radio" name="answer" id="b" value="b">
         <h4 id="hb" style="display: inline;">Answer B</h4> <br><br>
         <input type="radio" name="answer" id="c" value="c">
         <h4 id="hc" style="display: inline;">Answer C</h4> <br><br>
         <input type="radio" name="answer" id="d" value="d">
         <h4 id="hd" style="display: inline;">Answer D</h4> <br><br>

         <button id="submitBtn" type="button" onclick="submitAnswer(counter);">Submit Answer</button>
      </div>
   </div>

   <table id="table" style="display: none;"></table>

   <script>
      var counter = 1;
      var playerNum = 0;
      var name, house, player;

      function savePlayer() {
         localStorage.setItem("player", JSON.stringify(player));
      }

      function loadPlayer() {
         player = JSON.parse(localStorage.getItem("player"));
         document.getElementById("name").innerHTML = player.name;
         document.getElementById("house").innerHTML = player.house;
         document.getElementById("points").innerHTML = player.points;
      }

      function getData() {
         name = prompt("Enter your name.", "Name");
         house = prompt("Enter your Hogwarts House.", "House");

         player = new player(name, house);
         document.getElementById('name').innerHTML = player.name;
         document.getElementById('house').innerHTML = player.house;
         var x = document.getElementById('getData');
         x.setAttribute('disabled', '');
      }

      function player(name, house) {
         this.name = name;
         this.house = house;
         this.points = 0;
      }

      function youWin() {
         var x = document.getElementById("questionDiv");
         x.style.display = "none";

         var d = document.createElement("div");
         d.style.fontSize = "70";
         d.innerHTML = "YOU WIN!!!";

         document.getElementById("hpDiv").appendChild(d);

      }

      function submitAnswer(questionNum) {
         var data = document.getElementById("table").rows[questionNum].cells;
         var correctAnswer = data[5].innerHTML;
         var userAnswer = document.querySelector('input[name="answer"]:checked').value;
         console.log("correctAnswer: " + correctAnswer);
         console.log("userAnswer: " + userAnswer);

         if (correctAnswer == userAnswer) {
            counter++;
            if (counter < 5) {
               loadQuiz(counter);
            } else if (counter == 5) {
               youWin();
               return;
            }
         } else {
            alert("WRONG");
         }

         var radios = document.getElementsByName("answer");
         for (let index = 0; index < 4; index++) {
            radios[index].checked = false;
         }

      }

      function loadQuiz(questionNum) {
         var btn = document.getElementById("loadBtn");
         btn.style.display = "none";

         var data = document.getElementById("table").rows[questionNum].cells;
         document.getElementById("question").innerHTML = data[0].innerHTML;
         document.getElementById("ha").innerHTML = data[1].innerHTML;
         document.getElementById("hb").innerHTML = data[2].innerHTML;
         document.getElementById("hc").innerHTML = data[3].innerHTML;
         document.getElementById("hd").innerHTML = data[4].innerHTML;
      }

      function loadXML() {

         var xhttp = new XMLHttpRequest();
         xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
               myFunction(this);
            }
         };
         xhttp.open("GET", "quiz.xml", true);
         xhttp.send();
      }

      function myFunction(xml) {
         var i;
         var xmlDoc = xml.responseXML;
         var table = "<tr><th>Question</th><th>AnswerA</th><th>AnswerB</th><th>AnswerC</th><th>AnswerD</th><th>CorrectAnswer</th></tr>";
         var x = xmlDoc.getElementsByTagName("QUESTION");
         for (i = 0; i < x.length; i++) {
            table += "<tr><td>";
            table += x[i].getElementsByTagName("TEXT")[0].childNodes[0].nodeValue;
            table += "</td><td>";
            table += x[i].getElementsByTagName("ANSWERA")[0].childNodes[0].nodeValue;
            table += "</td><td>";
            table += x[i].getElementsByTagName("ANSWERB")[0].childNodes[0].nodeValue;
            table += "</td><td>";
            table += x[i].getElementsByTagName("ANSWERC")[0].childNodes[0].nodeValue;
            table += "</td><td>";
            table += x[i].getElementsByTagName("ANSWERD")[0].childNodes[0].nodeValue;
            table += "</td><td>";
            table += x[i].getElementsByTagName("CORRECTANSWER")[0].childNodes[0].nodeValue;
            table += "</td></tr>";
         }
         document.getElementById("table").innerHTML = table;
      }

   </script>
</body>

</html>